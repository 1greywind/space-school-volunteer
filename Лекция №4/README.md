# Школа волонтеров ЛКШ•2020. Лекция №4
## Рандеву на орбите. Пакет программ KSP Trajectory Optimization Tool

[Ссылка на запись лекции на канале "Твой Сектор Космоса"](https://www.youtube.com/watch?v=U26xtm4HVF0).

### Краткое содержание лекции:
* Как догнать другой космический корабль?
* От чего зависит период орбиты
* Сидерический период
* Фазирование орбиты
* Рандеву на орбите
* Переход между точками стояния на ГСО
* Общие сведения о интерфейсе KSP TOT: настройки
* Операции внутри полей ввода данных
* Работа с временными метками
* Расчет оптимального перехода между орбитами в два маневра (Optimal 2-burn orbit change)
* Расчет маневров для рандеву (Rendezvouse Maneuver Sequencer)
* Ассистент выполнения маневров (Maneuver Execution Assistant)
* Расчет пусковых окон (Porkchop plotter)

### Задания для Лекции №4:

Обозначения элементов орбиты:
а - большая полуось,
р - высота перицентра,
ap - высота апоцентра
e - эксцентриситет,
☊ - долгота восходящего узла,
ω - аргумент перицентра,
ν - истинная аномалия

#### Самостоятельно повторите то, что было показано на лекции:
* Расположите два корабля А и Б на круговых экваториальных орбитах вокруг Земли с высотой 200 и 400 км и достаточным фазовым расстоянием между ними. Используя средства KSP проведите фазирование орбиты корабля А, содайте маневры перехвата и рандеву и выполните их.
* Расположите космический корабль на геостационарной орбите в точке стояния над Южной америкой. С помощью фазирования орбиты переведите космический корабль в точку стояния над Индийским океаном. Постарайтесь затратить минимум топлива на выполнение этой операции.

#### Создайте и выполните план полета:
* Расположите корабль на орбите вокруг Луны: ap=40000, p=1200, i=96°, ω=170). С помощью утилиты Optimal 2-burn orbit change расчитайте маневры перехода на орбиту p=200, e=0, i=0 и постарайтесь их выполнить с помощью утилиты Maneuver Execution Assistant.
* Расположите два корабля А и Б на круговых орбитах вокруг Земли.
  Орбита А аналогична орбите китайском косической станции «Тяньгун-1»: p=355 км, i=42°, e=0.001, ☊=151°.
  Орбита Б аналогична орбите Международной космической станции: p=418, i=51.6, e=0.001, ☊=124°. Истиные аномалии возьмите произвольные.
  С помощью утилиты Rendezvouse Maneuver Sequencer расчитайте маневры для рандеву корабля Б с кораблем А. Не забывайте варьировать окно интервала времени для рандеву (т.к. в случае большой разницы фаз подходящие маневры могут иметь дату на несколько дней или недель в будующем).
  Постарайтесь их выполнить с помощью утилиты Maneuver Execution Assistant.
  <i>Описанный выше сценарий аналогичен финальному перелету из фильма «Гравитация»</i>

### Как выполнять задания

Внимание! Для выполнения задания по оптимизации траекторий потребуется установить пакет KSP TOT!
Инструкция по установке находится ниже:

1. Подготовьте рабочую среду
   1. Установите программу Kerbal Space Program (инструкцию по установке см. ниже)
   2. Cкачайте и установите KSP TOT (инструкция для Windows, инструкцию для установки под Linux и MacOS можно найти на [официальной странице пакета (англ.)](https://forum.kerbalspaceprogram.com/index.php?/topic/33568-winmaclinux-ksp-trajectory-optimization-tool-v165-major-lvd-updates/))
        1. Для работы пакета понадобится скачать и установить [Windows 64-bit 2017b MATLAB Compiler Runtime (MCR)](http://ssd.mathworks.com/supportfiles/downloads/R2017b/deployment_files/R2017b/installers/win64/MCR_R2017b_win64_installer.exe)
        2. Затем нужно скачать и распаковать [архив с пакетом KSP TOT](https://drive.google.com/file/d/0B83Py_-98MhoSG16X09NOFN6SE0/view?usp=sharing)
        3. После этого нужно запустить KSPTrajectoryOptimizationTool.exe (запуск может занимать достаточно продолжительное время: 5-10 минут на слабых компьютерах)
        4. Далее нужно будет импортировать данные о небесных телах Солнечной системы из KSP - см. пункт (9) инструкции ниже 
   
   2. Cкачайте архив с [файлами занятий](https://github.com/1greywind/space-school-volunteer/raw/master/Лекция%20№3/Школа_волонтеров_Задания_для_лекции_№3.zip)
   3. Распакуйте архив в папку /ваша папка, где установлена KSP/Saves
2. Запустите КСП
3. В главном меню выберите пункт "Начать игру"
4. Далее выберите "Сохраненная игра"
5. В появившемся меню выберите "Школа волонтеров - Задания для лекции №4" и либо кликните на этом пункте два раза, либо нажмите "Загрузить".
6. На экране космического центра нажмите ALT+F5, чтобы открыть список сохраненных состояний. Выберите в нем либо
   "Два КА для рандеву", либо "один КА для выполнения маневров с ассистентом"
7. На экране космического центра нажмите на значок Станции слежения слева (шестой сверху, с иконкой антенны)
   либо нажмите на здание Станции слежения в космическом центре
8. Внутри станции слежения выберите один из космических аппаратов и перейдите к нему двойным щелчком
9. Импортировать данные о небесных телах Солнечной системы из KSP в KSP TOT (нужно сделать один раз) 
    1. В главном окне KSP TOT зайдите в меню File
    2. Выберите пункт Create New Bodies File from KSP (KSP должна быть запущена на сцене полета, также требуется плагин KSPTOTConnect - он включен в сборку модов)
    3. Подождите пока импорт завершится - индикатором этого будет появление диалогового окна сохранения файла с импортированными данными. Дайте ему название, н.п. rss-bodies.ini и сохраните.
    4. В главном окне KSP TOT зайдите в меню File
    5. Выберите пункт Load Bodies File и укажите сохраненный недавно файл импорта.
    6. В версии KSP TOT 1.6.5 есть баг, из-за которого не сохраняется автоматически путь к файлу с данными небесных тел. Чтобы импортированные данные корректно подгружались каждый раз при открытии программ нужно:
        1. Открыть в текстовом редакторе файл appOptions.ini из папки, где находится KSP TOT
        2. В строке, которая начинается с *bodiesinifile =* прописать путь к вашему файлу с данными небесных тел
    7. Теперь можно запускать Архитектор Миссий:
        1. В главном окне KSP TOT зайдите в меню Tools / Mission Planning
        2. Выберите пункт Mission Architect
        3. Загрузка приложения Mission Architect может занимать несколько минут
        4. Видеоинструкция по работе с Mission Architect есть в Лекциях №3 и №4
    
10. После выполнения задания нажмите ALT+F9 и сохраните состояние, дав ему соответствующее имя (например, "Выполненное задание №1"). Не забудьте сохранять сценарии полета в Архитекторе миссий! Они не сохраняются при сохранении состояния в KSP!
11. Результат задания пришлите в чат ЛКШ•2020 [в Контакте](https://vk.me/join/AJQ1d_3CuBfywdM9wDb9kgNs)
    или [в Телеграме](https://t.me/space_school_chat) в форме скриншотов, видео или сохраненных файлов
12. В Лекции №4 содержится подробный видео туториал, в котором показаны описанные выше шаги.


Для выполнения большинства домашних занятий вам потребуется программа Kerbal Space Program

## Инструкция по установке Kerbal Space Program (KSP):
1. Приобретите KSP на
    [сайте разработчика](https://www.kerbalspaceprogram.com/store/),
    [онлайн магазине Steam](https://store.steampowered.com/app/220200/Kerbal_Space_Program/),
    [или GOG](https://www.gog.com/game/kerbal_space_program)
    (наименьшая цена в рублях будет скорее всего в стиме - 250-300 р. по скидке)
2. Установите программу (если у вас возникают трудности или вопросы,
   пишите в чат ЛКШ•2020 [в Контакте](https://vk.me/join/AJQ1d_3CuBfywdM9wDb9kgNs)
   или [в Телеграме](https://t.me/space_school_chat)
3. Так как нужные для выполнения задания модификации требуют версию KSP 1.8.1, то:
    1. При покупке игры через Steam выберите игру в списке
    2. Нажмите правой кнопкой и выберите там пункт "Свойства"
    3. В появившемся окне перейдите на таб "Бета-версии"
    4. И там выберите из списка 1.8.1 
4. Скачайте архив с комплектом необходимых дополнений [по ссылке](http://spaceprogram.ru/GameData-LKSH-2020-volunteer-modpack.zip)
5. Распакуйте архив в папку /ваша папка, где установлена KSP/GameData
6. Запустите KSP


