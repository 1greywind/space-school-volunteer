# Школа волонтеров Летней Космической Школы. Лекция №3
## Планирование и оптимизация траекторий

[Ссылка на запись лекции на канале "Твой Сектор Космоса"](https://www.youtube.com/watch?v=U26xtm4HVF0).

### Краткое содержание лекции:
* План маршрута на Земле (на примере автомобиля)
* Как ставится задача навигатору при построении маршрута на Земле
* План полета в космосе
* Постановка задачи о маршруте в космосе
* Космический полет, как набор событий
* Тип событий: свободный полет
* Тип событий: импульсный маневр
* Переменные оптимизации
* Граничные условия
* Функции оптимизации
* Выбор результата оптимизации
* Архитектор миссий из пакета KSP TOT
* Формирование сценария полета в Архитекторе миссий
* Импорт и экспорт маневров из Архитектора Событий в KSP
* Пример оптимизации сценария полета с гомановским переходом с одной орбиты на другую
* Пример оптимизации сценария полета на Луну

### Задания для Лекции №3:

Обозначения элементов орбиты:
а - большая полуось,
р - высота перицентра,
e - эксцентриситет,
☊ - долгота восходящего узла,
ω - аргумент перицентра,
ν - истинная аномалия

#### Самостоятельно повторите то, что было показано на лекции:
* Используя Архитектор миссий, составьте план полета для перехода с орбиты (p=600 км, e=0, i=0°) на орбиту (p=5000 км, e=0, i=0°) и проведите оптимизацию
* Составьте план полета для перехода с орбиты (p=1000, e=0.5, i=90°, ☊=0°) на орбиту (p=1000 км, e=0.5, i=90°, ☊=15°) и проведите оптимизацию
* Спланируйте перелет с низкой земной орбиты (p=400 км, e=0, i=51°) на oрбиту Луны (p=400 км, е=0) и проведите оптимизацию

#### Создайте и выполните план полета:
* Используя Архитектор миссий, составьте план полета для перехода с орбиты (p=200 км, e=0, i=51°) на орбиту (p=35786 км, e=0, i=0°) по трех-импульсной схеме, проведите оптимизацию и попробуйте выполнить маневры, используя КА Заря.
* Составьте план полета для изменения точки стояния на геостационарной орбите с истинной аномалией ν=120° на ν=0°, т.е. с орбиты (a=35786 км, e=0, i=0°, ν=120°) на орбиту (a=35786 км, e=0, i=0°, ν=0°), проведите оптимизацию и попробуйте выполнить маневры, используя КА Север.
* Спланируйте облет Луны с низкой земной орбиты (p=600 км, e=0, i=23°) с возвращением на орбиту Земли с перицентром p=600 км (по т.н. траектории со свободным возвращением) и попробуйте выполнить его, используя КА Заря.

### Как выполнять задания

Внимание! Для выполнения задания по оптимизации траекторий потребуется установить пакет KSP TOT!
Инструкция по установке находится ниже:

1. Подготовьте рабочую среду
   1. Установите программу Kerbal Space Program (инструкцию по установке см. ниже)
   2. Cкачайте и установите KSP TOT (инструкция для Windows, инструкцию для установки под Linux и MacOS можно найти на [официальной странице пакета (англ.)](https://forum.kerbalspaceprogram.com/index.php?/topic/33568-winmaclinux-ksp-trajectory-optimization-tool-v165-major-lvd-updates/))
        1. Для работы пакета понадобится скачать и установить [Windows 64-bit 2017b MATLAB Compiler Runtime (MCR)](http://ssd.mathworks.com/supportfiles/downloads/R2017b/deployment_files/R2017b/installers/win64/MCR_R2017b_win64_installer.exe)
        2. Затем нужно скачать и распаковать [архив с пакетом KSP TOT](https://drive.google.com/file/d/0B83Py_-98MhoSG16X09NOFN6SE0/view?usp=sharing)
        3. После этого нужно запустить KSPTrajectoryOptimizationTool.exe (запуск может занимать достаточно продолжительное время: 5-10 минут на слабых компьютерах)
        4. Далее нужно будет импортировать данные о небесных телах Солнечной системы из KSP - см. пункт (9) инструкции ниже 
   
   2. Cкачайте архив с [файлами занятий](https://github.com/1greywind/space-school-volunteer/raw/master/Лекция%20№3/Школа_волонтеров_Задания_для_лекции_№3.zip)
   3. Распакуйте архив в папку /ваша папка, где установлена KSP/Saves
2. Запустите КСП
3. В главном меню выберите пункт "Начать игру"
4. Далее выберите "Сохраненная игра"
5. В появившемся меню выберите "Школа волонтеров - Задания для лекции №3" и либо кликните на этом пункте два раза, либо нажмите "Загрузить".
6. На экране космического центра нажмите ALT+F5, чтобы открыть список сохраненных состояний. Выберите в нем либо
   "КА Заря на орбите 51 градус", либо "КА Север на эквотариальной орбите":
   1. КА Заря оснащен ЯРД и имеет большой запас ΔV > 7000 м/с, но имеет небольшую тяговооруженность. Подходит для планирования полета к Луне и обратно.
   2. КА Север оснащен ЖРД и имеет запас ΔV > 4000 м/с и тяговооруженность ~1. Удобен для планирования и оптимизации орбитальных маневров.
7. На экране космического центра нажмите на значок Станции слежения слева (шестой сверху, с иконкой антенны)
   либо нажмите на здание Станции слежения в космическом центре
8. Внутри станции слежения выберите один из космических аппаратов и перейдите к нему двойным щелчком
9. Импортировать данные о небесных телах Солнечной системы из KSP в KSP TOT (нужно сделать один раз) 
    1. В главном окне KSP TOT зайдите в меню File
    2. Выберите пункт Create New Bodies File from KSP (KSP должна быть запущена на сцене полета, также требуется плагин KSPTOTConnect - он включен в сборку модов)
    3. Подождите пока импорт завершится - индикатором этого будет появление диалогового окна сохранения файла с импортированными данными. Дайте ему название, н.п. rss-bodies.ini и сохраните.
    4. В главном окне KSP TOT зайдите в меню File
    5. Выберите пункт Load Bodies File и укажите сохраненный недавно файл импорта.
    6. В версии KSP TOT 1.6.5 есть баг, из-за которого не сохраняется автоматически путь к файлу с данными небесных тел. Чтобы импортированные данные корректно подгружались каждый раз при открытии программ нужно:
        1. Открыть в текстовом редакторе файл appOptions.ini из папки, где находится KSP TOT
        2. В строке, которая начинается с *bodiesinifile =* прописать путь к вашему файлу с данными небесных тел
    7. Теперь можно запускать Архитектор Миссий:
        1. В главном окне KSP TOT зайдите в меню Tools / Mission Planning
        2. Выберите пункт Mission Architect
        3. Загрузка приложения Mission Architect может занимать несколько минут
        4. Видеоинструкция по работе с Mission Architect есть в Лекции №3
    
10. После выполнения задания нажмите ALT+F9 и сохраните состояние, дав ему соответствующее имя (например, "Выполненное задание №1"). Не забудьте сохранять сценарии полета в Архитекторе миссий! Они не сохраняются при сохранении состояния в KSP!
11. Результат задания пришлите в чат ЛКШ•2021 [в Контакте](https://vk.me/join/AJQ1d_3CuBfywdM9wDb9kgNs)
    или [в Телеграме](https://t.me/space_school_chat) в форме скриншотов, видео или сохраненных файлов
12. В Лекции №3 содержится подробный видео туториал, в котором показаны описанные выше шаги.


Для выполнения большинства домашних занятий вам потребуется программа Kerbal Space Program

## Инструкция по установке Kerbal Space Program (KSP):
1. Приобретите KSP на
    [сайте разработчика](https://www.kerbalspaceprogram.com/store/),
    [онлайн магазине Steam](https://store.steampowered.com/app/220200/Kerbal_Space_Program/),
    [или GOG](https://www.gog.com/game/kerbal_space_program)
    (наименьшая цена в рублях будет скорее всего в стиме - 250-300 р. по скидке)
2. Установите программу (если у вас возникают трудности или вопросы,
   пишите в чат ЛКШ•2021 [в Контакте](https://vk.me/join/AJQ1d_3CuBfywdM9wDb9kgNs)
   или [в Телеграме](https://t.me/space_school_chat)
3. Так как нужные для выполнения задания модификации требуют версию KSP 1.8.1, то:
    1. При покупке игры через Steam выберите игру в списке
    2. Нажмите правой кнопкой и выберите там пункт "Свойства"
    3. В появившемся окне перейдите на таб "Бета-версии"
    4. И там выберите из списка 1.8.1 
4. Скачайте архив с комплектом необходимых дополнений [по ссылке](http://spaceprogram.ru/GameData-LKSH-2020-volunteer-modpack.zip)
5. Распакуйте архив в папку /ваша папка, где установлена KSP/GameData
6. Запустите KSP


